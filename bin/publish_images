#!/usr/bin/env bash
set -euo pipefail

source ".env"

source bin/build_images sonarscanner

echo "Logging into ghcr..."
echo "${GITHUB_TOKEN}" | docker login ghcr.io --username "${GITHUB_USER}" --password-stdin

echo "Pushing images to ghcr..."
echo ghcr.io/stax-labs/sonarscannerbuildkite/sonarscanner:"${PLUGIN_VERSION}" | xargs -n 1 docker push

echo "Logging out of ghcr..."
docker logout
